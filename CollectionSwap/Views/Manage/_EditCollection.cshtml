@model CollectionSwap.Models.EditCollectionModel
@using Newtonsoft.Json;
@{
    string statusMessage = ViewBag.Status;
    List<string> items = JsonConvert.DeserializeObject<List<string>>(Model.Collection.ItemListJSON);
}
<div class="row">
    <button class="scroll-row-button" onclick="ScrollRowBack(this)"><i class="fa fa-angle-left"></i></button>

    <span class="header">
        Edit Collection
    </span>
</div>

<section class="gap-1">
    <div class="row gap-2">
        @using (Html.BeginForm("ChangeCollectionName", "Manage", null, FormMethod.Post, new { enctype = "multipart/form-data", role = "form", id = "update-name-form", @class = "edit-collection-form" }))
        {
            <div class="form-group">
                @Html.AntiForgeryToken()
                @Html.HiddenFor(model => model.Collection.Id)

                @Html.LabelFor(model => model.Collection.Name)
                @Html.TextBoxFor(model => model.Collection.Name, new { @class = "" })
                @Html.ValidationMessageFor(model => model.Collection.Name, "", new { @class = "text-danger" })
                <input class="submit-button" type="submit" value="Update Name" />
            </div>
        }

        @using (Html.BeginForm("AddItem", "Manage", null, FormMethod.Post, new { enctype = "multipart/form-data", role = "form", id = "add-item-form", @class = "edit-collection-form" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                @Html.HiddenFor(model => model.Collection.Id)
                @Html.HiddenFor(model => model.Collection.Name)

                @Html.LabelFor(model => model.FileInput)
                @Html.TextBoxFor(model => model.FileInput, null, new { type = "file", accept = ".png, .jpg", @class = "" })
                @Html.ValidationMessageFor(model => model.FileInput, "", new { @class = "text-danger" })
                <input class="submit-button" type="submit" value="Upload" />
            </div>
        }
    </div>

    <div id="items">
        @foreach (var item in items)
        {
            var imagePath = $"~/Collections/{Model.Collection.Id}";
            var itemId = items.IndexOf(item) + 1;

            <div class="column align-items-center gap-1">
                @(item.Split('?')[0])
                <img class="item" src="@Url.Content(imagePath)/@item" />
                <div class="row gap-1">
                    @using (Html.BeginForm("EditItem", "Manage", new { collectionId = @Model.Collection.Id, itemId = @itemId - 1, fileName = @item }, FormMethod.Post, new { enctype = "multipart/form-data" }))
                    {
                        @Html.AntiForgeryToken()
                        <label for="fileInput@(itemId)"><span class="button-icon button-icon-upload"><i class="fa fa-upload"></i></span></label>
                        <input class="d-none" type="file" id="fileInput@(itemId)" name="fileInput" accept = ".png, .jpg">
                    }
                    @using (Html.BeginForm("DeleteItem", "Manage", new { collectionId = @Model.Collection.Id, fileName = @item }, FormMethod.Post, new { role = "form", @class = "mt-3" }))
                    {
                        @Html.AntiForgeryToken()
                        <button class="button-icon button-icon-trash" type="submit" onclick="return confirm('Are you sure you want to delete this item?')"><i class="fa-solid fa-trash"></i></button>
                    }
                </div>
            </div>
        }
    </div>
</section>