@model CollectionSwap.Models.EditCollectionModel
@using Newtonsoft.Json;
@{
    string statusMessage = ViewBag.Status;
    List<string> items = JsonConvert.DeserializeObject<List<string>>(Model.Collection.ItemListJSON);
}
<div id="edit-collection-container" class="">

    <div class="secondary-container-header">
        <p>Edit Collection</p>
    </div>
    <div class="tertiary-container flex-column">
        <span class="success-message">@ViewBag.AddItemStatus</span>
        <div class="d-flex flex-row gap-5 flex-wrap">
            @using (Html.BeginForm("ChangeCollectionName", "Manage", null, FormMethod.Post, new { enctype = "multipart/form-data", role = "form", id = "update-name-form", @class = "" }))
            {
                <div class="account-form-column">
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(model => model.Collection.Id)

                    @Html.LabelFor(model => model.Collection.Name)
                    @Html.TextBoxFor(model => model.Collection.Name, new { @class = "" })
                    @Html.ValidationMessageFor(model => model.Collection.Name, "", new { @class = "text-danger" })
                    <input type="submit" value="Update Name" />
                </div>
            }

            @using (Html.BeginForm("AddItem", "Manage", null, FormMethod.Post, new { enctype = "multipart/form-data", role = "form", id = "update-name-form", @class = "" }))
            {
                @Html.AntiForgeryToken()
                <div class="account-form-column">
                    @Html.HiddenFor(model => model.Collection.Id)
                    @Html.HiddenFor(model => model.Collection.Name)

                    @Html.LabelFor(model => model.FileInput)
                    @Html.TextBoxFor(model => model.FileInput, null, new { type = "file", accept = ".png, .jpg", @class = "" })
                    @Html.ValidationMessageFor(model => model.FileInput, "", new { @class = "text-danger" })
                    <input type="submit" value="Upload" />
                </div>
            }
        </div>

        <div id="items" class="account-form-row">
            @foreach (var item in items)
            {
                var imagePath = $"~/Collections/{Model.Collection.Id}";
                var itemId = items.IndexOf(item) + 1;

                <div class="d-flex flex-column align-items-center">
                    @(item.Split('?')[0])
                    <img class="item" src="@Url.Content(imagePath)/@item" />
                    <div class="d-flex gap-3">
                        @using (Html.BeginForm("EditItem", "Manage", new { collectionId = @Model.Collection.Id, itemId = @itemId - 1, fileName = @item }, FormMethod.Post, new { enctype = "multipart/form-data", role = "form", @class = "mt-3" }))
                        {
                            @Html.AntiForgeryToken()
                            <label for="fileInput@(itemId)" class="button-icon button-icon-upload"><i class="fa fa-upload"></i></label>
                            <input class="d-none" type="file" id="fileInput@(itemId)" name="fileInput">
                        }
                        @using (Html.BeginForm("DeleteItem", "Manage", new { collectionId = @Model.Collection.Id, fileName = @item }, FormMethod.Post, new { role = "form", @class = "mt-3" }))
                        {
                            @Html.AntiForgeryToken()
                            <button class="button-icon button-icon-trash" type="submit" onclick="return confirm('Are you sure you want to delete this item?')"><i class="fa fa-trash"></i></button>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>