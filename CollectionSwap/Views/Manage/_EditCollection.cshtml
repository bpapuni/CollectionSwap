@model CollectionSwap.Models.Collection
@using Newtonsoft.Json;
@{
    string statusMessage = ViewBag.Status;
    List<string> items = JsonConvert.DeserializeObject<List<string>>(Model.ItemListJSON);
}
<div id="edit-collection-container" class="">

    <div class="secondary-container-header">
        <p>Edit Collection</p>
    </div>
    <div class="tertiary-container flex-column">
        @using (Html.BeginForm("EditCollection", "Manage", null, FormMethod.Post, new { enctype = "multipart/form-data", role = "form", id = "update-name-form", @class = "" }))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(model => model.Id)
            <label><strong>Collection Name</strong></label>
            @Html.TextBoxFor(model => model.Name, new { @class = "" })
            @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
            <input type="submit" value="Update Name" />
        }
        <span class="text-success">@statusMessage</span>

        <div id="items" class="account-form-row">
            @foreach (var item in items)
            {
                var imagePath = $"~/Collections/{Model.Id}";
                var itemId = items.IndexOf(item) + 1;

                <div class="d-flex flex-column align-items-center">
                    @(item.Split('?')[0])
                    <img class="item" src="@Url.Content(imagePath)/@item" />
                    <div class="d-flex gap-3">
                        @using (Html.BeginForm("EditItem", "Manage", new { collectionId = @Model.Id, itemId = @itemId - 1, fileName = @item }, FormMethod.Post, new { enctype = "multipart/form-data", role = "form", @class = "mt-3" }))
                        {
                            @Html.AntiForgeryToken()
                            <label for="fileInput@(itemId)" class="button-icon button-icon-upload"><i class="fa fa-upload"></i></label>
                            <input class="d-none" type="file" id="fileInput@(itemId)" name="fileInput">
                        }
                        @using (Html.BeginForm("DeleteItem", "Collections", new { collectionId = @Model.Id, fileName = @item }, FormMethod.Post, new { role = "form", @class = "mt-3" }))
                        {
                            @Html.AntiForgeryToken()
                            <button class="button-icon button-icon-trash" type="submit" onclick="return confirm('Are you sure you want to delete this item?')"><i class="fa fa-trash"></i></button>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
    @*<div>
            @using (Html.BeginForm("CreateItem", "Collections", new { collectionId = @Model.Id }, FormMethod.Post, new { enctype = "multipart/form-data", role = "form", @class = "mt-3" }))
            {
                @Html.AntiForgeryToken()
                <label for="createItemInput" class="create-item"><i class="fa fa-plus"></i></label>
                <input class="d-none" type="file" accept=".png, .jpg" id="createItemInput" name="fileInput">
            }
        </div>*@
</div>